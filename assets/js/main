let countries = [];
let activeIndex = -1;


async function loadCountries() {
const response = await fetch('/around-the-world-board-games/data/countries.json');
countries = await response.json();
}


function renderResults(matches, resultsEl) {
resultsEl.innerHTML = '';
matches.forEach((country, index) => {
const li = document.createElement('li');
li.innerHTML = `<a href="/around-the-world-board-games/countries/${country.slug}.html">${country.name}</a>`;
if (index === activeIndex) li.classList.add('active');
resultsEl.appendChild(li);
});
resultsEl.style.display = matches.length ? 'block' : 'none';
}


document.addEventListener('DOMContentLoaded', async () => {
await loadCountries();


const input = document.getElementById('countrySearch');
const results = document.getElementById('searchResults');


if (!input || !results) return;


input.addEventListener('input', () => {
activeIndex = -1;
const query = input.value.toLowerCase();
if (!query) {
results.style.display = 'none';
return;
}


const matches = countries.filter(c =>
c.name.toLowerCase().includes(query)
);


renderResults(matches, results);
});


input.addEventListener('keydown', (e) => {
const items = results.querySelectorAll('li');
if (!items.length) return;


if (e.key === 'ArrowDown') {
activeIndex = (activeIndex + 1) % items.length;
e.preventDefault();
}


if (e.key === 'ArrowUp') {
activeIndex = (activeIndex - 1 + items.length) % items.length;
e.preventDefault();
}


if (e.key === 'Enter' && activeIndex >= 0) {
items[activeIndex].querySelector('a').click();
}


renderResults(
countries.filter(c => c.name.toLowerCase().includes(input.value.toLowerCase())),
});